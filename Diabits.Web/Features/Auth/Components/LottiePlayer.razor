@implements IAsyncDisposable

<div @ref="_host" style="@Style"></div>

@code {
    private ElementReference _host;
    private IJSObjectReference? _module;
    private IJSObjectReference? _instance;

    [Inject] public IJSRuntime JS { get; set; } = default!;

    [Parameter, EditorRequired] public string Path { get; set; } = default!;
    [Parameter] public bool Loop { get; set; } = true;
    [Parameter] public bool Autoplay { get; set; } = true;
    [Parameter] public string Renderer { get; set; } = "svg";
    [Parameter] public string Style { get; set; } = "width:100%;height:100%;pointer-events:none;";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        _module = await JS.InvokeAsync<IJSObjectReference>("import", "./js/lottiePlayer.js");
        _instance = await _module.InvokeAsync<IJSObjectReference>("create", _host, Path, Loop, Autoplay, Renderer);
    }

    public async ValueTask DisposeAsync()
    {
        try
        {
            if (_instance is not null) await _instance.InvokeVoidAsync("dispose");
            if (_module is not null) await _module.DisposeAsync();
        }
        catch { }
    }
}
